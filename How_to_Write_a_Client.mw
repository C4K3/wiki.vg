This tutorial is being created to document what it takes to write a stand-alone client to interact with a notchian server (version Beta 1.2_01). The tutorial is incomplete but will be updated whenever more information is discovered.

== Before You Get Started ==

* Make sure you don't want to join or fork an existing project instead.
* Ponder how much work it will be.
* Download the latest official minecraft server and run it with authentication turned off. Bind it to localhost if you want.

== Parsing the messages ==

''Main article: [[Protocol]]''

Sorry, but you have to be able to parse ''all'' the messages. Write all the message parsing code. If you don't, your client will effectively crash if the server sends you any message you can't parse. 

== Login ==

Connect to the server at localhost, port 25565.

''Main article: [[Protocol FAQ]]''

Paraphrase (with no authentication): send a 0x02, get a 0x02, send a 0x01, get a 0x01. Then you'll eventually get a 0x0D, and that's when the game really begins.

To test if this worked, connect to your localhost server with the notchian client and see if you can see your custom client appear and float in the air.

== Getting the map chunks ==

Once you get your first 0x0D, you have to convince the server that you deserve to know about all the map chunks that are around you.

* Every 200 milliseconds, send one of 0x0A - 0x0D.

You will get several fragments of chunks at first that are very far away from your location. Ignore these, since the chunks they are in will be loaded fully later. Full chunks load spiraling outward from your location in a circular (not square) pattern, eventually creating a 20x20 square for a total of 400 chunks.

To test if this worked, count the number of 0x33 map chunk messages you get that are full-sized chunks (16,128,16). If you don't get any, or you only get a couple, you probably aren't sending the 0x0A - 0x0D properly.

== Moving around ==

Send the server updates on your position (0x0A - 0x0D) at every 50 milliseconds. This section was written experimenting with sending only 0x0D messages. You can send position updates slower, but it causes health updates to be slower.

The server will mostly keep quiet about your position, which means that your movements are acceptable. If the server sends you your position, it means you've done something wrong. In this situation, you must apologize by sending back identical data or else the server will begin ignoring any future position updates. The jerking effect that happens in this event can be seen in notchian clients when trying to walk across missing chunks.

The walking animation is automatically displayed in notchian clients when you move around on the ground. There's no walking animation when you move straight up and down though.

=== Allowed super-human abilities ===

* '''Flying''' - float and move about in the air. You must set on-ground to false to move vertically. Gravity only exists if you say it exists.
* '''Walking in the air''' - walk off a cliff with on-ground set to true. The avatar will continue walking as if there were ground bellow him. Maybe the server doesn't even check any correlation between on-ground and proximity to the ground.
* '''Moving arbitrarily fast''' - update your position to move as far as you like with each step to move arbitrarily fast (as long as you have a clear path). Tested up to 1000m in a single step.

=== Restrictions ===

* You cannot intersect with solid blocks. Your bounding box is an apothem of 0.3m in the horizontal axises, and 1.74m from your feet to the top of your head.
* You cannot move through walls. If there are solid blocks in your way, you have to move around them no matter how fast you're going.

If you break any of the above rules, the server will send you your corrected position. Corrected positions preserve your on-ground status, even if you were trying to fall through the top of a solid block. Note that sometimes increasing the rate of position update messages will help the server follow along and not correct your position. 50 milliseconds seems to be a good update interval.

=== Look and Stance ===

Look is defined by yaw and pitch. Providing the yaw component to the server rotates your avatar's head about the vertical-axis. The notion of an avatar's body orientation seems to exist only in clients and updates automatically in notchian clients when players rotate their yaw and move around. Providing the pitch component rotates your avatar's head up and down. There seems to be no limit to the pitch, so providing a pitch of 180 degrees result in your avatar's head appearing upsidedown. See [[Protocol]] for how the yaw and pitch values are calibrated.

Modifying your stance seems to have no visible effect. Its purpose is known.

=== Fall damage ===

Fall damage happens when on-ground changes from false to true and the fall height is greater than some threshold around 4 meters. Fall height seems to be calculated by the difference between the point where on-ground changed to true and the highest point of the jump/fall/flight while on-ground was false.

TODO: can you avoid fall damage while flying if you set on-ground to true in the air?

=== Testing/Debugging ===

To test if moving around is working, watch your avatar move around from a notchian client.

If your avatar remains still despite your position update messages, then maybe you didn't apologize in response to the server correcting your position. Reconnect to give yourself another chance.

If your avatar is invisible to notchian clients despite the server sending you reasonable spawn coordinates, then maybe you died. Watch for 0x08 health updates to verify this cause. Try respawning or deleting the server's player file (world/players/<username>.dat) to recover from this situation.

== Digging ==

Requirements from the server to break a block
* The dig modifier is '3'
* The distance from the players eyes to the block is less than 16
* For the server to process 0 and 1 modifiers, you must be within 6.0 of the center of the block you are mining
* Waiting between packets doesn't seem necessary (And can break digging. Conditions need verification)
* Face of the block is currently not validated and neither is where the player looks

=== To dig a block ===

{| class="wikitable"
|- class="row0"
| class="col0" | Optional arm animation
| class="col1" | [[Protocol#Animation_.280x12.29|0x12]], entity_id, 1
|- class="row1"
| class="col0 leftalign" | Start digging
| class="col1 centeralign" | [[Protocol#Player_Digging_.280x0E.29|0x0e]], 0, x, y, z, face
|- class="row2"
| class="col0 leftalign" | Dig (send multiple)
| class="col1 centeralign" | [[Protocol#Player_Digging_.280x0E.29|0x0e]], 1, x, y, z, face
|- class="row3"
| class="col0 leftalign" | Break block
| class="col1 centeralign" | [[Protocol#Player_Digging_.280x0E.29|0x0e]], 3, x, y, z, face
|- class="row4"
| class="col0 leftalign" | Stop digging
| class="col1 centeralign" | [[Protocol#Player_Digging_.280x0E.29|0x0e]], 2, 0, 0, 0, 0
|}

=== How many times do I have to dig? ===

Dig counts varies with block type and equipped tool. The wrong tool will take damage while the right tool will lower the amount of digs required. Digging too many times doesn't seem to have a negative effect.

'''NOTE:''' Needs verification. Empty handed dig requires many more than this.

'''NOTE:''' Holding a random block seems to require same amount of digs as empty hands.

{| class="wikitable"
|- class="row0"
! class="col0" | Block
! class="col1" | Empty hand
! class="col2" | Wood Shovel
|- class="row1"
| class="col0 leftalign" | Sand
| class="col1 centeralign" | 76
| class="col2 centeralign" | 38
|- class="row2"
| class="col0 leftalign" | Dirt
|- class="row3"
| class="col0 leftalign" | Stone
|- class="row4"
| class="col0 leftalign" | Wood
|- class="row5"
| class="col0 leftalign" | Obsidian
| class="col1 centeralign" | 1002
|}

=== Left to test ===
* Can you dig behind blocks?
* Digging further than 6 blocks away
* Is tools enforced to drop blocks like stone?
* What happens to your tool if you dig too many times?
* Figure out tool modifiers to number of digs and verify dig counts on different blocks

== Placing/using stuff ==

TODO: can you place blocks from behind walls?

== Inventory and Crafting ==

When you log in, before you get a 0x0D, you will get a 0x68 Window Items with your complete inventory including armor. You will then get a series of 0x67 Set Slot messages repeating the information for each non-empty slot. The slot indexes of these messages are for an inventory window with the crafting zone empty.

TODO: more info.

== Attacking mobs/players ==

TODO

== Chat ==

''Main article: [[Chat]]''

== Health and Respawning ==

The server sends 0x08 health updates whenever your health changes. If the server sends a health value less than 1, you are dead. Your avatar will disappear a second or two after dying. The "fall over" animation is not automatic.

You can safely send a 0x09 Respawn immediately after you get a death notice. You'll be given a 0x0D and possibly other messages after you do.

If your health updates come much slower than on the notchian client, make sure your sending position updates fast enough.
