<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>Region Files - wiki.vg</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Region_Files","wgTitle":"Region Files","wgCurRevisionId":13222,"wgRevisionId":13222,"wgArticleId":240,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Minecraft Modern"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Region_Files","wgRelevantArticleId":240,"wgRequestId":"2979697e9d926f7df2d0cbe3","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user.cssprefs":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0j3lz3q",function($,jQuery,require,module){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens@12oj1re",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/;

});mw.loader.load(["mediawiki.page.startup","skins.vector.js"]);});</script>
<link rel="stylesheet" href="https://wiki.vg/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector"/>
<script async="" src="https://wiki.vg/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="https://wiki.vg/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector"/>
<meta name="generator" content="MediaWiki 1.28.2"/>
<link rel="shortcut icon" href="https://wiki.vg/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="https://wiki.vg/opensearch_desc.php" title="wiki.vg (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.vg/api.php?action=rsd"/>
<link rel="copyright" href="http://creativecommons.org/licenses/by-sa/3.0/"/>
<link rel="alternate" type="application/atom+xml" title="wiki.vg Atom feed" href="https://wiki.vg/index.php?title=Special:RecentChanges&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Region_Files rootpage-Region_Files skin-vector action-view">		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">Region Files</h1>
									<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From wiki.vg</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="Region_Files.html#mw-head">navigation</a>, 					<a href="Region_Files.html#p-search">search</a>
				</div>
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>The latest version of the Minecraft game uses a new, more efficient (but still poor) format for storing a worlds chunk data, based on work by Scaevolous.
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="Region_Files.html#Background_.26_Reasoning"><span class="tocnumber">1</span> <span class="toctext">Background &amp; Reasoning</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="Region_Files.html#Specification"><span class="tocnumber">2</span> <span class="toctext">Specification</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="Region_Files.html#File_Names"><span class="tocnumber">2.1</span> <span class="toctext">File Names</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="Region_Files.html#Structure"><span class="tocnumber">2.2</span> <span class="toctext">Structure</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="Region_Files.html#Location_Table"><span class="tocnumber">2.2.1</span> <span class="toctext">Location Table</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="Region_Files.html#Timestamp_Table"><span class="tocnumber">2.2.2</span> <span class="toctext">Timestamp Table</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="Region_Files.html#Chunk_Header"><span class="tocnumber">2.2.3</span> <span class="toctext">Chunk Header</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="Background_.26_Reasoning">Background &amp; Reasoning</span></h2>
<p>Prior to this system, each chunk (a 16x16x128 area of a level) was contained within its own file on disk, two folders down. The first folder represented the <code>X</code> region, and the second the <code>Y</code> region. This (very obviously) has several issues associated with it, mainly:
</p>
<ul><li> Excessive filesystem activity,</li>
<li> Poor fragmentation,</li>
<li> Unneeded filesystem overhead (a 90-byte compressed chunk of mostly dirt and air will still consume at a minimum one sector, generally more),</li>
<li> Generates large enough directory trees on large worlds to crash the Windows Explorer,</li>
<li> A large multiplayer world would eventually run out of handles (by default, only 1024 handles can be opened by a single process), causing the server to stall, crash, or otherwise fail (the particular behaviour has changed between versions)</li></ul>
<p>To improve performance, Scaevolous created an unofficial mod called McRegion. This mod groups chunks into <i>regions</i>, each of which contains a group of <i>chunks</i> 32 by 32. In theory, this improves a few things:
</p>
<ul><li> Reduces filesystem activity &amp; overhead considerably,</li>
<li> Improves fragmentation (not directly, but the OS or underlying drive can intelligently improve it),</li>
<li> Far, far fewer handles need to be open at any given time, allowing more of the level to be loaded at any one time.</li>
<li> Reduces the number of files created considerably (no more crashing Explorer)</li></ul>
<p>To define some terminology,
</p>
<table class="wikitable">

<tr>
<th> Chunk
</th>
<td> A single section of the level that is 16 by 16 blocks, and 128 blocks high.
</td></tr>
<tr>
<th> Region
</th>
<td> A single grouping of <i>chunks</i> in a 32 by 32 area
</td></tr>
<tr>
<th> Level
</th>
<td> A (realistically, but not technically) unlimited collection of <i>chunks</i> stored in <i>regions</i> that make up a single playable world.
</td></tr></table>
<h2><span class="mw-headline" id="Specification">Specification</span></h2>
<h3><span class="mw-headline" id="File_Names">File Names</span></h3>
<p>In the official client and server, each region is stored within the folder <code>region</code> within the level folder. The naming scheme for region files is very simple. For example, given the filename <code>r.8.20.mcr</code>, <code>r</code> is a meaningless prefix found on all region files, <code>8</code> is the <code>X</code> coordinate of the region, and <code>20</code> is the <code>Z</code> coordinate of the region.
</p><p>The region <code>X</code> and <code>Z</code> can be found simply by dividing the chunks <code>X</code> or <code>Z</code> by 32, and then <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Floor_and_ceiling_functions">flooring</a> the result. Here&#39;s an example in python, where given a chunk at &lt;81, -39&gt;, the region filename can be found:
</p>
<pre>&gt;&gt;&gt; import math
&gt;&gt;&gt; region_xz = lambda x,z: &#40;math.floor&#40;x / 32&#41;, math.floor&#40;z / 32&#41;&#41;
&gt;&gt;&gt; region_xz&#40;81,-39&#41;
&#40;2.0, -2.0&#41;
</pre>
<p>So, this chunk would reside in <code>r.2.-2.mcr</code>.
</p><p>Here&#39;s an example in java, where given a chunk at &lt;-152, 15&gt;:
</p>
<pre>int x = -152;
int z = 15;
String regionFileName = "r." + (int) Math.floor(x / 32) + "." + (int) Math.floor(z / 32) + ".mcr";</pre>
<p>So, this chunk would reside in <code>r.-4.0.mcr</code>.
</p><p>Simple to use tool for calcualting region filenames made in java is available for download <a rel="nofollow" class="external text" href="http://www.mediafire.com/download/mb2cfs8iae977hn/MC_Region_Calculator.jar">here</a>.
</p>
<h3><span class="mw-headline" id="Structure">Structure</span></h3>
<p>Every region file begins with two 4KiB tables (each compose of 1024 4-byte integers), with the first table containing the location of each chunk, and the second table the last-modified timestamp of that chunk.
</p>
<h4><span class="mw-headline" id="Location_Table">Location Table</span></h4>
<p>The location table is composed of 1024 entries, each 4 bytes long. The first three bytes indicate the offset in the file where the chunk may be found, and the last byte is the size of the file. When multiplied by <code>4096</code>, this gives you the exact start of the chunk in bytes, and its end in bytes. If you know the <code>X</code> and <code>Z</code> of the chunk you&#39;re looking for, you can find its location entry using the formula: <code>((x&#160;% 32) + (z&#160;% 32) * 32) * 4</code>. If the offset and size are both <code>0</code>, then the chunk at that location hasn&#39;t been generated yet.
</p><p>As an example, this is the location entry for the first chunk in a region:
</p>
<table class="wikitable">

<tr>
<td>
</td>
<th>  Offset  (3 bytes)
</th>
<th>  Size  (1 byte)
</th></tr>
<tr>
<th> Decoded
</th>
<td> <code>2</code>
</td>
<td> <code>1</code>
</td></tr>
<tr>
<th> On Disk (in hex)
</th>
<td> <code>00 00 02</code>
</td>
<td> <code>01</code>
</td></tr></table>
<p>Here&#39;s an example in Python to decode a location entry:
</p>
<pre>def chunk_location&#40;l&#41;:
    &quot;&quot;&quot;
    Returns the offset (in bytes) and size (in bytes) of the chuck for
    the given location.
    &quot;&quot;&quot;
    offset = &#40;&#40;l &gt;&gt; 8&#41; &amp; 0xFF&#41; + &#40;&#40;l &gt;&gt; 16&#41; &amp; 0xFF&#41; + &#40;&#40;l &gt;&gt; 32&#41; &amp; 0xFF&#41;
    size = l &amp; 0xFF
 
    return &#40;offset * 4096, size * 4096&#41;
</pre>
<h4><span class="mw-headline" id="Timestamp_Table">Timestamp Table</span></h4>
<p>The timestamp table is composed of 1024 timestamps, each a 4-byte integer. This is the time that the chunk was last modified, and is in the same order as the location table. Thus, the chunk whose location was at <code>location_table[15]</code> has a timestamp at <code>timestamp_table[15]</code>.
</p>
<h4><span class="mw-headline" id="Chunk_Header">Chunk Header</span></h4>
<p>Each chunk has an additional 5-byte header, followed by the actual chunk which is stored as <a href="NBT.html" title="NBT">NBT</a>.
</p>
<table class="wikitable">

<tr>
<td>
</td>
<th>  Length (in bytes)
</th>
<th>  Compression Scheme
</th></tr>
<tr>
<th> Decoded
</th>
<td> <code>528</code>
</td>
<td> <code>2</code>
</td></tr>
<tr>
<th> On disk (in hex)
</th>
<td> <code>00 00 02 10</code>
</td>
<td> <code>02</code>
</td></tr></table>
<p>There are two possible values for the compression scheme. If it is a <code>1</code>, the following chunk is compressed using <a href="http://en.wikipedia.org/wiki/gzip" class="extiw" title="wikipedia:gzip">gzip</a>. If it's a <code>2</code>, the following chunk is compressed with <a href="http://en.wikipedia.org/wiki/zlib" class="extiw" title="wikipedia:zlib">zlib</a>. In practice, you will only ever encounter chunks compressed using zlib.
</p>
<!-- 
NewPP limit report
Cached time: 20180823151520
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.026 seconds
Real time usage: 0.037 seconds
Preprocessor visited node count: 54/1000000
Preprocessor generated node count: 92/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->

<!-- Saved in parser cache with key wiki-wiki_:pcache:idhash:240-0!*!0!!en!*!* and timestamp 20180823151520 and revision id 13222
 -->
</div>					<div class="printfooter">
						Retrieved from "<a dir="ltr" href="http://wiki.vg/index.php?title=Region_Files&amp;oldid=13222">http://wiki.vg/index.php?title=Region_Files&amp;oldid=13222</a>"					</div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://wiki.vg/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="./Category:Minecraft_Modern.html" title="Category:Minecraft Modern">Minecraft Modern</a></li></ul></div></div>				<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>

			<div id="mw-head">
									<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
						<h3 id="p-personal-label">Personal tools</h3>
						<ul>
							<li id="pt-createaccount"><a href="https://wiki.vg/index.php?title=Special:CreateAccount&amp;returnto=Region+Files" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="https://wiki.vg/index.php?title=Special:UserLogin&amp;returnto=Region+Files" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>						</ul>
					</div>
									<div id="left-navigation">
										<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
						<h3 id="p-namespaces-label">Namespaces</h3>
						<ul>
															<li  id="ca-nstab-main" class="selected"><span><a href="Region_Files.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
															<li  id="ca-talk" class="new"><span><a href="https://wiki.vg/index.php?title=Talk:Region_Files&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t" rel="discussion">Discussion</a></span></li>
													</ul>
					</div>
										<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
												<h3 id="p-variants-label">
							<span>Variants</span><a href="Region_Files.html#"></a>
						</h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
									</div>
				<div id="right-navigation">
										<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
						<h3 id="p-views-label">Views</h3>
						<ul>
															<li id="ca-view" class="selected"><span><a href="Region_Files.html" >Read</a></span></li>
															<li id="ca-viewsource"><span><a href="https://wiki.vg/index.php?title=Region_Files&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
															<li id="ca-history" class="collapsible"><span><a href="https://wiki.vg/index.php?title=Region_Files&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
													</ul>
					</div>
										<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
						<h3 id="p-cactions-label"><span>More</span><a href="Region_Files.html#"></a></h3>

						<div class="menu">
							<ul>
															</ul>
						</div>
					</div>
										<div id="p-search" role="search">
						<h3>
							<label for="searchInput">Search</label>
						</h3>

						<form action="https://wiki.vg/index.php" id="searchform">
							<div id="simpleSearch">
							<input type="search" name="search" placeholder="Search wiki.vg" title="Search wiki.vg [f]" accesskey="f" id="searchInput"/><input type="hidden" value="Special:Search" name="title"/><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton"/><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton"/>							</div>
						</form>
					</div>
									</div>
			</div>
			<div id="mw-panel">
				<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="index.html"  title="Visit the main page"></a></div>
						<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
			<h3 id='p-navigation-label'>Navigation</h3>

			<div class="body">
									<ul>
						<li id="n-mainpage-description"><a href="index.html" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-recentchanges"><a href="https://wiki.vg/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-randompage"><a href="https://wiki.vg/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li><li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>					</ul>
							</div>
		</div>
			<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
			<h3 id='p-tb-label'>Tools</h3>

			<div class="body">
									<ul>
						<li id="t-whatlinkshere"><a href="https://wiki.vg/Special:WhatLinksHere/Region_Files" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="https://wiki.vg/Special:RecentChangesLinked/Region_Files" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="https://wiki.vg/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="https://wiki.vg/index.php?title=Region_Files&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="https://wiki.vg/index.php?title=Region_Files&amp;oldid=13222" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="https://wiki.vg/index.php?title=Region_Files&amp;action=info" title="More information about this page">Page information</a></li>					</ul>
							</div>
		</div>
				</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 28 July 2017, at 00:43.</li>
											<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a> unless otherwise noted.</li>
									</ul>
							<ul id="footer-places">
											<li id="footer-places-privacy"><a href="./wikivg:Privacy_policy.html" title="wikivg:Privacy policy">Privacy policy</a></li>
											<li id="footer-places-about"><a href="./wikivg:About.html" title="wikivg:About">About wiki.vg</a></li>
											<li id="footer-places-disclaimer"><a href="./wikivg:General_disclaimer.html" title="wikivg:General disclaimer">Disclaimers</a></li>
									</ul>
										<ul id="footer-icons" class="noprint">
											<li id="footer-copyrightico">
							<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="resources/assets/licenses/cc-by-sa.png" alt="Creative Commons Attribution Share Alike" width="88" height="31"/></a>						</li>
											<li id="footer-poweredbyico">
							<a href="https://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="resources/assets/poweredby_mediawiki_132x47.png 1.5x, resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"/></a>						</li>
									</ul>
						<div style="clear:both"></div>
		</div>
		<script>(window.RLQ=window.RLQ||[]).push(function(){mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);});</script><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-11145163-13");
pageTracker._trackPageview();
</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":140});});</script>
	</body>
</html>
